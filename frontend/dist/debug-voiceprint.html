<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å£°çº¹æå–è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f5f5f5;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>ğŸ¤ å£°çº¹æå–è°ƒè¯•å·¥å…·</h1>

    <div>
        <h3>æ­¥éª¤1: é€‰æ‹©éŸ³é¢‘æ–‡ä»¶</h3>
        <input type="file" id="audioFile" accept="audio/*">
    </div>

    <div>
        <h3>æ­¥éª¤2: æå–ç‰¹å¾</h3>
        <button id="extractBtn">æå–å£°çº¹ç‰¹å¾</button>
    </div>

    <div id="result"></div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="./voiceprint-extractor-fast.js?v=20250203-5"></script>
    <script src="./voiceprint-matcher.js?v=20250203-5"></script>

    <script>
        const resultDiv = document.getElementById('result');

        function log(message, isError = false) {
            const p = document.createElement('p');
            p.className = isError ? 'error' : 'success';
            p.textContent = message;
            resultDiv.appendChild(p);
            console.log(message);
        }

        document.getElementById('extractBtn').addEventListener('click', async () => {
            resultDiv.innerHTML = '';

            const fileInput = document.getElementById('audioFile');
            const file = fileInput.files[0];

            if (!file) {
                log('âŒ è¯·å…ˆé€‰æ‹©éŸ³é¢‘æ–‡ä»¶', true);
                return;
            }

            log('ğŸ“‚ æ–‡ä»¶: ' + file.name);
            log('ğŸ“Š å¤§å°: ' + (file.size / 1024).toFixed(2) + ' KB');
            log('ğŸµ ç±»å‹: ' + file.type);
            log('');

            try {
                // æ£€æŸ¥ç±»æ˜¯å¦åŠ è½½
                log('ğŸ” æ£€æŸ¥ VoiceprintExtractor: ' + (typeof VoiceprintExtractor));
                if (typeof VoiceprintExtractor === 'undefined') {
                    throw new Error('VoiceprintExtractor æœªåŠ è½½');
                }

                // åˆ›å»ºæå–å™¨
                log('ğŸ› ï¸ åˆ›å»ºæå–å™¨å®ä¾‹...');
                const extractor = new VoiceprintExtractor();

                // æå–ç‰¹å¾
                log('â³ å¼€å§‹æå–ç‰¹å¾...');
                const startTime = Date.now();

                const result = await extractor.extractFromFile(file);

                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);

                log('');
                log('âœ… æå–æˆåŠŸ!');
                log('â±ï¸ è€—æ—¶: ' + duration + ' ç§’');
                log('ğŸ“Š ç‰¹å¾å‘é‡ç»´åº¦: ' + result.vector.length);
                log('â° éŸ³é¢‘æ—¶é•¿: ' + result.duration.toFixed(2) + ' ç§’');
                log('ğŸµ é‡‡æ ·ç‡: ' + result.sampleRate + ' Hz');
                log('');
                log('ğŸ”¢ å‘é‡å‰10ç»´:');
                log(JSON.stringify(result.vector.slice(0, 10).map(v => v.toFixed(4))));

            } catch (error) {
                log('', true);
                log('âŒ æå–å¤±è´¥!', true);
                log('é”™è¯¯ä¿¡æ¯: ' + error.message, true);
                log('é”™è¯¯å †æ ˆ:', true);
                log(error.stack, true);
                console.error('å®Œæ•´é”™è¯¯:', error);
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            log('âœ… é¡µé¢åŠ è½½å®Œæˆ');
            log('âœ… VoiceprintExtractor: ' + (typeof VoiceprintExtractor !== 'undefined' ? 'å·²åŠ è½½' : 'æœªåŠ è½½'));
            log('âœ… VoiceprintMatcher: ' + (typeof VoiceprintMatcher !== 'undefined' ? 'å·²åŠ è½½' : 'æœªåŠ è½½'));
        });
    </script>
</body>
</html>
