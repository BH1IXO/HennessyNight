# 讯飞语音API获取指南

## 🎯 需要的服务

**服务名称：语音听写（流式版）/ 实时语音转写**

⚠️ **重要：** 不是其他服务！必须是**实时语音转写**或**语音听写（流式版）**

API地址：`wss://iat-api.xfyun.cn/v2/iat`

---

## 📋 获取步骤（图文详解）

### 第一步：注册讯飞账号

1. 访问：https://www.xfyun.cn/
2. 点击右上角"注册"或"登录"
3. 使用手机号或邮箱注册

**免费额度：**
- 语音听写：500小时/年
- 足够开发和测试使用！

---

### 第二步：创建应用

1. 登录后，进入控制台：https://console.xfyun.cn/
2. 点击左侧菜单 **"控制台"** → **"我的应用"**
3. 点击 **"创建新应用"** 按钮

**填写信息：**
- 应用名称：`智能会议系统`（随意填）
- 应用平台：选择 **"WebAPI"**
- 应用领域：选择 **"智能语音"**

4. 点击 **"提交"** 创建应用

---

### 第三步：添加语音听写服务

1. 在"我的应用"列表中，找到刚创建的应用
2. 点击应用名称，进入应用详情
3. 点击 **"添加服务"** 或 **"能力管理"**
4. **重要：** 找到并选择 **"语音听写（流式版）"** 或 **"实时语音转写"**
   - ⚠️ 不要选错其他服务！
   - 服务ID通常是：`iat`
   - WebSocket接口
5. 点击 **"确认添加"**

---

### 第四步：获取密钥

在应用详情页面，你会看到：

```
┌─────────────────────────────────────┐
│ 应用信息                             │
├─────────────────────────────────────┤
│ APPID:      12345678                │  ← 复制这个
│ APISecret:  abc123def456...         │  ← 复制这个
│ APIKey:     xyz789uvw012...         │  ← 复制这个
└─────────────────────────────────────┘
```

**需要复制三个密钥：**
1. **APPID** (8位数字)
2. **APISecret** (32位字符串)
3. **APIKey** (32位字符串)

---

### 第五步：配置到项目

编辑 `D:\Hennessy.uno\meeting-system-backend\.env` 文件：

```env
# 讯飞语音配置（实时转录）⭐ 必需
IFLYTEK_APP_ID=12345678
IFLYTEK_API_KEY=xyz789uvw012...
IFLYTEK_API_SECRET=abc123def456...
```

**粘贴你复制的三个密钥！**

---

## 🔍 如何确认是正确的服务？

在讯飞控制台，确认以下信息：

### 正确的服务特征 ✅
- 服务名称：**语音听写（流式版）** 或 **实时语音转写**
- 接口协议：**WebSocket**
- 接口地址包含：`iat-api.xfyun.cn`
- 服务类型：**实时转写**
- 支持格式：音频流

### 错误的服务 ❌（不要选这些）
- ❌ 语音合成
- ❌ 语音唤醒
- ❌ 声纹识别（这是讯飞自己的声纹，我们用pyannote）
- ❌ 离线语音识别
- ❌ 短语音识别（一句话识别）

---

## 📸 控制台截图位置说明

**位置1：我的应用**
```
控制台 → 左侧菜单"我的应用" → 看到应用列表
```

**位置2：应用详情**
```
点击应用名称 → 进入详情页 → 看到APPID/APIKey/APISecret
```

**位置3：服务管理**
```
应用详情 → "能力管理"或"添加服务" → 搜索"语音听写"
```

---

## 🧪 测试配置

配置完成后，测试是否正确：

```bash
# 1. 重启服务器
npm run dev

# 2. 查看启动日志
# 应该看到：
✅ 讯飞语音: 已配置
```

---

## 💡 常见问题

### Q1: 找不到"语音听写"服务？

**答：** 可能是账号类型问题
- 确保是个人开发者账号
- 实名认证后才能使用
- 某些服务需要申请试用

### Q2: 密钥在哪里复制？

**答：**
```
控制台 → 我的应用 → 点击应用名称 →
在页面顶部会看到 APPID、APIKey、APISecret
```

### Q3: 有多个密钥怎么办？

**答：**
- 只用**一个应用**的密钥
- 三个密钥必须来自**同一个应用**
- 不要混用不同应用的密钥

### Q4: 需要付费吗？

**答：**
- 免费版有足够的配额（500小时/年）
- 开发测试完全够用
- 超出后可以购买套餐

### Q5: 为什么不用讯飞的声纹识别？

**答：**
- 讯飞声纹需要单独注册和训练
- pyannote.audio是开源免费的
- pyannote性能更好，更灵活
- 我们只用讯飞做语音转文字

---

## 📋 配置检查清单

完成后请确认：

- [ ] 注册了讯飞账号
- [ ] 创建了应用
- [ ] 添加了"语音听写（流式版）"服务 ⭐ 重要！
- [ ] 复制了三个密钥（APPID、APIKey、APISecret）
- [ ] 粘贴到 `.env` 文件
- [ ] 三个密钥来自同一个应用
- [ ] 保存了 `.env` 文件

---

## 🎯 快速链接

- 讯飞官网：https://www.xfyun.cn/
- 控制台：https://console.xfyun.cn/
- 我的应用：https://console.xfyun.cn/app/myapp
- API文档：https://www.xfyun.cn/doc/asr/voicedictation/API.html

---

## 🚀 完成后

配置完成后，你的 `.env` 文件应该包含：

```env
# ✅ 数据库
DATABASE_URL="postgresql://..."

# ✅ 讯飞语音
IFLYTEK_APP_ID=12345678
IFLYTEK_API_KEY=你的APIKey
IFLYTEK_API_SECRET=你的APISecret

# ✅ DeepSeek AI
DEEPSEEK_API_KEY=sk-54c3f8dd90f145e8919f05dc7f137722

# ✅ pyannote
PYANNOTE_DEVICE=cpu
```

然后就可以测试**完整功能**了！🎉

---

**需要帮助？**
- 查看讯飞官方文档
- 或者截图控制台页面，我帮你确认
